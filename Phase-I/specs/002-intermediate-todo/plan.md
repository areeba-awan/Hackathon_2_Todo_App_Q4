# Implementation Plan: Phase I Intermediate - Todo Console App Enhancement

**Branch**: `002-intermediate-todo` | **Date**: 2026-01-06 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/sp.specify` for intermediate-level todo app features

## Summary

Extends the Phase I in-memory Python console todo application with intermediate usability features: priority levels, tags, search, filter, and sort capabilities. The implementation adds JSON file persistence for data durability while maintaining pure console-based interaction. All features build incrementally on existing Phase I CRUD operations.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: json (standard library)
**Storage**: JSON file (tasks.json) for persistence
**Testing**: pytest
**Target Platform**: Console terminal (80x24 minimum)
**Project Type**: Single Python console application
**Performance Goals**: Sub-2-second response for search/filter/sort operations
**Constraints**: In-memory data structure, no external databases, single-user
**Scale/Scope**: Single user, up to several hundred tasks

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Gate | Status | Notes |
|------|--------|-------|
| Spec-Driven Development (SDD) | ✅ PASS | Followed spec → plan → tasks → code workflow |
| No Manual Coding | ✅ PASS | All code will be generated by /sp.implement |
| No Feature Invention | ✅ PASS | Features match specification exactly |
| Phase Scope Isolation | ✅ PASS | No Phase II/III features included |
| Clean Architecture | ✅ PASS | Separation of concerns planned |
| Existing Basic Features | ✅ PASS | All Phase I features remain functional |

## Project Structure

### Documentation (this feature)

```text
specs/002-intermediate-todo/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
│   ├── cli-commands.md
│   └── todo-service.yaml
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
src/
├── models/
│   └── task.py          # Extended Task dataclass
├── services/
│   └── todo_service.py  # Extended with search/filter/sort
├── cli/
│   ├── main.py          # Updated menu with new options
│   ├── handlers.py      # Updated command handlers
│   └── menu.py          # Updated menu options
tests/
├── unit/
│   ├── test_task.py     # Extended tests
│   └── test_service.py  # Extended tests
└── integration/
    └── test_app.py      # Integration tests
tasks.json               # Created at runtime for persistence
```

**Structure Decision**: Single project structure with clear separation between models, services, and CLI layers. Extends existing Phase I structure without introducing new directories.

## Complexity Tracking

> No constitutional violations requiring justification. All design choices align with constitution requirements.

## Step-by-Step Implementation Plan

### Phase 0: Research & Design Decisions

**Objective**: Resolve any technical uncertainties and document design choices.

1. **Data Structure Extensions**: Define Task dataclass with new fields (priority, tags, due_date, order).
2. **JSON Persistence Format**: Design JSON schema for task serialization/deserialization.
3. **Search Algorithm**: Determine case-insensitive substring matching approach.
4. **Filter Logic**: Design multi-criteria filter with AND semantics.
5. **Sort Strategy**: Define stable sort behavior for each sort mode.

### Phase 1: Model Layer

**Objective**: Extend the data model to support all intermediate features.

1. **Extend Task Dataclass**: Add priority (enum), tags (list), due_date (string), order (int) fields.
2. **Add Validation Methods**: Priority enum validation, tag format validation (lowercase hyphenated).
3. **Add Serialization**: JSON export/import methods for persistence.
4. **Create TaskFilter Class**: Encapsulate filter state (status, priority, tag).
5. **Create SortMode Enum**: Define priority, alpha, date_added, manual options.

### Phase 2: Service Layer

**Objective**: Implement business logic for all intermediate features.

1. **Extend TodoService**: Add search method (case-insensitive title/description match).
2. **Add Filter Method**: Chainable filters with AND logic across status/priority/tag.
3. **Add Sort Methods**: Implement all four sort modes with stable behavior.
4. **Add Manual Reorder**: up/down commands to modify order field.
5. **Add Persistence**: Auto-save to tasks.json on every modification.
6. **Add Load**: Load tasks from tasks.json on service initialization.

### Phase 3: CLI Layer

**Objective**: Expose all features through console menu interface.

1. **Update Add Command**: Prompt for priority (default MEDIUM) and tags (max 5).
2. **Update View Command**: Table format with priority, tags, status, due_date columns.
3. **Update Update Command**: Allow modifying priority and tags separately.
4. **Add Search Command**: Accept keyword, apply to current view.
5. **Add Filter Commands**: filter status/priority/tag with clear option.
6. **Add Sort Command**: sort priority/alpha/date_added/manual modes.
7. **Add Reorder Commands**: up <id>, down <id> for manual sorting.
8. **Add Clear Command**: Reset search/filter/sort state.

### Phase 4: Testing

**Objective**: Verify all features work correctly and preserve basic functionality.

1. **Unit Tests**: Test Task dataclass validation, serialization, new field behavior.
2. **Unit Tests**: Test service layer search, filter, sort methods.
3. **Unit Tests**: Test CLI handlers for new commands.
4. **Integration Tests**: Test complete user workflows for each feature.
5. **Persistence Tests**: Test save/load functionality with various scenarios.
6. **Edge Case Tests**: Test invalid inputs, boundary conditions, error handling.

### Phase 5: Validation

**Objective**: Verify all success criteria are met.

1. **Performance Testing**: Verify search/filter/sort complete within 2 seconds.
2. **User Flow Testing**: Verify all user scenarios from spec are executable.
3. **Backward Compatibility**: Verify existing Phase I features still work.
4. **Error Handling**: Verify all validation failures produce user-friendly messages.

## Feature Dependency Order

```
                    ┌─────────────────┐
                    │  Model Layer    │
                    │  (Phase 1)      │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
      ┌───────────┐  ┌───────────┐  ┌───────────────┐
      │ Search    │  │ Filter    │  │ Sort          │
      │ (Phase 2) │  │ (Phase 2) │  │ (Phase 2)     │
      └─────┬─────┘  └─────┬─────┘  └───────┬───────┘
            │              │                │
            └──────────────┼────────────────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │  CLI Layer      │
                  │  (Phase 3)      │
                  └────────┬────────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │  Testing        │
                  │  (Phase 4)      │
                  └────────┬────────┘
                           │
                           ▼
                  ┌─────────────────┐
                  │  Validation     │
                  │  (Phase 5)      │
                  └─────────────────┘
```

**Critical Path**: Model → Service → CLI → Testing → Validation

**Parallel Work**: Search, Filter, and Sort can be developed in parallel within the Service layer since they all depend only on the Model layer.

## Completion Criteria for Intermediate Level

| Criterion | Measure |
|-----------|---------|
| All FRs implemented | 24 functional requirements verified |
| Priority/Tag features | Add, update, display working |
| Search functionality | Case-insensitive keyword search working |
| Filter functionality | Status, priority, tag filters working |
| Sort functionality | All 4 sort modes working |
| Manual reorder | up/down commands working |
| Persistence | Auto save/load to tasks.json |
| Basic features intact | CRUD + mark complete/incomplete unchanged |
| Tests passing | 100% unit + integration tests pass |
| Performance met | Search/filter/sort < 2 seconds |
| Error handling | User-friendly messages for all failures |
